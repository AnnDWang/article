## 闭包简介
闭包是JavaScript的重要特性，那么什么是闭包？

闭包就是指有权访问另一个函数中的变量的函数。创建闭包的常见方式，就是在一个函数内部创建另一个函数。

我们来看一个简单的例子：
```
var scope = "global scope";
function checkScope(){
    var scope = "local scope";
    function f() { return scope; }
    return f();
}
checkScope();//输出为“local scope”
```
当函数第一次被调用时，会创建一个执行环境以及相应的作用域链，作用域链的前端，始终都是当前执行代码所在环境的变量对象，作用域链中的下一个变量对象来自包含外部环境，下一个变量则来自下一个外部环境，这样一直延续到全局执行环境。

标识符解析是沿着作用域链一级一级搜索标识符的，搜索过程从作用域链前端开始，逐级向后，直至找到标识符位置。

在上边的例子中，访问scope时，在作用域链最前端就找到了scope，值为“local scope”，然后返回。

## 循环中的闭包
使用闭包时一种常见的错误情况是循环中的闭包，很多初学者都遇到了这个问题：
```
function createFunctions(){
    var result = new Array();
    for(var i = 0; i < 10; i++) {
        result[i] = function() {
          return i;  
        };
    }
    return result;
}
```
这段代码期望返回一个函数数组，其中的每个函数应该返回自己的索引值，即result[0]=0，result[1]=1，...，result[9]=9。但是实际上，每个函数都返回10，这是当createFunctions()函数执行完毕之后，函数执行环境被销毁，但是闭包仍然保留着对其中变量i的绑定，而内部函数还没有执行，这个时候i已经变成了10，内部函数捕获的i都是同一个i了，这时候再去访问函数数组中的函数，返回的都是10了。

这一部分理解也可以参考[http://www.cnblogs.com/qieguo/p/5457040.html。](http://www.cnblogs.com/qieguo/p/5457040.html。)

那么我们为了得到想要的结果，需要在每次循环中创建变量i的拷贝，下面提供三种方法。

第一、使用匿名包装器

```
function createFunctions(){
    var result = new Array();
    for(var i = 0;i < 10;i++) {
        (function(e) {
            result[i] = function() {
                return e;  
            };
        })(i);
    }
    return result;
}
```
第二、从匿名包装器中返回一个函数：
```
function createFunctions() {
    var result = new Array();
    for(var i = 0;i < 10;i++) {
        result[i] = function(num) {
            return function() {
                return num;
            };
        }(i);
    }
    return result;
}
```
首先，定义了匿名函数，并将立即执行该匿名函数的结果赋值给数组，匿名函数有一个参数num，在调用每个函数时，我们传入了变量i，函数按值传递，就将变量i的当前值复制给参数num。而在这个匿名函数内部，又创建并返回了一个访问num的闭包，这样一来，result数组中的每个函数都有自己num变量的一个副本，因此可以返回各自不同的数值了。

第三、在循环中使用let

```
function createFunctions() {
    var result=new Array();
    for(let i = 0;i < 10;i++) {
        result[i] = function() {
          return i;  
        };
    }
    return result;
}
```
let是ES6新增的命令，用法类似于var，但是所声明的变量只能在let命令所在代码块内有效。

## 闭包的作用
1. 模拟私有变量。在函数内创建一个闭包，闭包就可以通过自己的作用域链访问函数内部的变量，可以创建用于访问私有变量的方法。访问私有变量和私有函数的方法被称为特权方法。

```
function MyObject(){
    var privateVariable = 10;
    function privateFunction() {
        return false;
    }
    //特权方法
    this.publicMethod = function() {
        privateVariable++;
        return privateFunction();
    };
}
```
2. 可以模仿块级作用域
JavaScript中没有块级作用域的概念，意味着在块语句中定义的变量，实际上包含在函数中的。如果临时需要一些变量，使用私有作用域。
```
function outputNumbers(count) {
    (function() {
        for(var i = 0;i < count;i++) {
        alert(i);
    }
    })();
    //在这里无法访问i
}
```
这种技术经常在全局作用域中被用在函数外部，从而限制向全局作用域中添加过多的变量和函数。


